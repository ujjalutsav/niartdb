<!DOCTYPE html>
<html>
<head>
  <title>Pie Chart</title>
  <!-- âœ… Chart.js v4 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- âœ… Datalabels plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
  <style>
    body { text-align: center; }
    #chart-container {
      width: 600px;
      height: 600px;
      margin: auto;
    }
  </style>
</head>
<style>
	@media print {
      .no-print {
        display: none !important;
</style>

<body>
<center>
<img class="no-print" src="NIA Logo.png" alt="description" align="center" width=100%>
</center>

<table id="captionTable" style="width:100%; border-collapse:collapse; text-align:center;">
  <tr>
    <td class="no-print" style="width:20%;text-align:left;background-color: white;font-size:10px;">Hover mouse cursor over<br>graph to see exact figures</td>
    <td id="reportName" style="width:50%;font-size:18px;font-weight: bold; font-family: Arial, sans-serif;text-align:center;">caption will come here</td>
    <td class="no-print"  style="width:30%;text-align:center;">
	      <img onclick="goBackAndRefresh()" src="Back.png" height="40px" alt="Excel" style="cursor: pointer;">&nbsp;&nbsp;&nbsp;&nbsp;
	      <img onclick="document.location='RO.html'" src="Home.png" height="40px" alt="Excel" style="cursor: pointer;">&nbsp;&nbsp;&nbsp;&nbsp;
	      <img onclick="window.print()" src="Print.png" height="40px" alt="Print" style="cursor: pointer;">
	</td>
  </tr>
</table>



<script>
// Function to get query parameter by name
function getQueryParam(name) {
    let urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name); // returns value or null
}

function getQueryParam2(unit) {
    let urlParams = new URLSearchParams(window.location.search);
    let rsUnit = urlParams.get(unit); // returns value or null  
    switch (rsUnit) {
        case "th":
            return "Thousands";
        case "lk":
            return "Lakhs";
        case "cr":
            return "Crores";
        default:
            return "Unknown Units";
    }
    
}

// Get variables from URL
let roName = getQueryParam("name");
let rsUnit = getQueryParam2("unit");


// Use them in innerHTML
document.getElementById("reportName").innerHTML = "<br>" + roName.slice(0, -2) + " (â‚¹ in " + rsUnit + ")<br><br>";
</script>

  <div id="chart-container">
    <canvas id="myChart"></canvas>
  </div>

  <script>
    const labels = JSON.parse(localStorage.getItem("chartLabels"));
    const values = JSON.parse(localStorage.getItem("chartValues"));

    // ðŸŽ¯ Dynamic radius based on label count
    let radiusValue = '80%'; 
    if (labels.length > 5 && labels.length <= 8) {
      radiusValue = '70%';
    } else if (labels.length > 8) {
      radiusValue = '60%';
    }

    const ctx = document.getElementById('myChart').getContext('2d');
    const colors = [
      '#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF',
      '#FF9F40','#8BC34A','#E91E63','#3F51B5','#009688'
    ];

    // Track offsets for slices
    let sliceOffsets = new Array(labels.length).fill(0);

    const myChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: labels,
        datasets: [{
          data: values,
          backgroundColor: colors,
          radius: radiusValue,
          offset: sliceOffsets // initial offsets = 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: { padding: 50 },
        plugins: {
          legend: { display: false },
          datalabels: {
            formatter: (value, context) => {
              let label = context.chart.data.labels[context.dataIndex];
              return label + " (" + value + ")";
            },
            color: (context) => {
              return context.dataset.backgroundColor[context.dataIndex];
            },
            align: 'end',
            anchor: 'end',
            offset: 15,
            font: { weight: 'bold', size: 12 }
          }
        },
        onClick: (event, elements) => {
          if (elements.length > 0) {
            const index = elements[0].index;
            // Reset all slices
            sliceOffsets = sliceOffsets.map(() => 0);
            // Toggle clicked slice
            sliceOffsets[index] = (myChart.data.datasets[0].offset[index] === 30) ? 0 : 30;
            myChart.data.datasets[0].offset = sliceOffsets;
            myChart.update();
          }
        }
      },
      plugins: [ChartDataLabels]
    });
  </script>

<script>
     function goBackAndRefresh()
	 {
		sessionStorage.setItem('forceReloadPrev', '1');
		history.go(-1);
	 }
</script>

</body>
</html>
